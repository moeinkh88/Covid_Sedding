# you cannot run this script. First go to CV5_10_20 and run needed parts then come here to use data

# Define the equation

function  F(t, x, par)

	Λ,μ,μp,ϕ1,ϕ2,β1,β2,δ,ψ,ω,σ,γS,γA,ηS,ηA=par
    S,E,IA,IS,R,P,D,N=x

    dS= Λ*N - β1*S*P/(1+ϕ1*P) - β2*S*(IA + IS)/(1+ϕ2*(IA+IS)) + ψ*E - µ*S
    dE= β1*S*P/(1+ϕ1*P)+β2*S*(IA+IS)/(1+ϕ2*(IA+IS)) - ψ*E - μ*E - ω*E
    dIA= (1-δ)*ω*E - (μ+σ)*IA - γA*IA
    dIS= δ*ω*E - (μ + σ)*IS - γS*IS
    dR=γS*IS + γA*IA - μ*R
    dP=ηA*IA + ηS*IS - μp*P
    dD=σ*(IA+IS)
    dN=Λ*N - σ*(IA+IS) - μ*N
    return [dS,dE,dIA,dIS,dR,dP,dD,dN]

end
Λ=19.995e-3 # birth rate (19.995 births per 1000 people)
μ=9.468e-3 # natural human death rate
Result=zeros(6,24)
# for 1
Result[1,:]=[0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.9999999999999999, 0.8798715649962986, 0.9999999999999999, 0.9999999999999999, 1.8499535475052764, 1.603615986735856e-5, 1.5262674173109518, 0.0002985390766466025, 6.697541829132995e-5, 0.2992596945330088, 0.057836448723028705, 0.29809200619547277, 0.057453308604477366, 0.053434514236306366, 0.00026201490362741625, 0.5033460062189178, 0.0008360851762415269, 10673.47408152276, 85.79289414979044, 81.1410396749793, 10.167114046675119]
# 2
Result[2,:]=[0.9821066353042401, 0.999999999321849, 0.9999999999995782, 0.9999999999959922, 0.9841387056353362, 0.9827741704564772, 0.9999999358531899, 0.4369453115621038, 8.958746469790456e-7, 0.26619301575200366, 1.1873704641456142e-5, 0.00011815037790291665, 0.25383564022075666, 0.08512069953005615, 0.21992266206285857, 0.0005033528845528234, 2.4552251749738377e-5, 0.017035780919130408, 0.7185931369338021, 0.0007291542908894724, 18236.61032541717, 108.1002259822424, 6.872471470018765, 219.47519549942547]
# 3
Result[3,:]=[0.9687622500068354, 0.9860118705501726, 0.9751318422488394, 0.9999999999999999, 0.9800274384851998, 0.9794780903904503, 0.9999999997966649, 0.6078823476775487, 9.256929571822982e-7, 0.9432178770097126, 2.360770158702577e-5, 0.0001649173399600714, 0.21814774447661484, 0.0044450867240488955, 0.18628653238140797, 0.0001943979404951123, 0.0005780920101352791, 0.012085354366759721, 0.42957730534794475, 0.001198612894303392, 18876.417616809184, 200.782756076335, 186.53202255470643, 261.4808119951402]
# 4
Result[4,:]=[0.9711313840975656, 0.9999999999965292, 0.9452029671028522, 0.9999999993406142, 0.99999999999981, 0.986078241492025, 0.9999998078824298, 0.8083717868181672, 6.685693899893727e-6, 0.35714439814122917, 8.992390522782526e-5, 0.00023624186699799525, 0.2860752086241533, 0.08545762490523567, 0.3251280284891647, 0.00011674112222240147, 4.386193571524831e-5, 0.014821405493987107, 0.06192315401026414, 0.014053459994973214, 19393.577491475073, 233.0314968504147, 60.21749092795803, 132.20916756819702]
# 5
Result[5,:]=[0.7000000001288792, 0.9998586742178679, 0.9999999999710162, 0.9999999999981016, 0.9999999999983978, 0.8176373952011453, 0.9999986314719851, 0.011128423369058381, 4.329678875267615e-8, 1.4027135238056712, 2.3187290079309127e-6, 0.0003526403542386163, 0.3058505770167049, 0.058386535044467065, 0.44260475503658137, 0.00010799502475210602, 4.534027011177843e-5, 0.013793278190515538, 0.4192302941807953, 0.0026718696364294156, 19967.145212252897, 187.75290788055563, 191.26463988770033, 252.15499875472312]
# 6
Result[6,:]=[0.999999999582746, 0.9999999922709019, 0.999996622244426, 0.9999999999999957, 0.9999989085879374, 0.7404996692760494, 0.9999979500935402, 0.039123418534829674, 5.438677739305143e-7, 0.08003722866250249, 4.263414595052485e-6, 5.5439266074563324e-5, 0.31457681892232814, 0.002175853199023985, 0.3086507950935573, 0.00010151058436266662, 0.0002800636661170787, 0.01835786909561496, 0.24791946772861997, 0.010366570800324165, 19969.764279039544, 37.44331336868943, 21.7698588334035, 55.75002192385863]

ErrFDE=[176.86646366992662, 2.193333e+02,  2.914866e+02, 3.689140e+02, 5.006503e+02, 8.273753e+02]
ErrFDE5=zeros(6)
ErrFDE10=zeros(6)
ErrFDE20=zeros(6)
ErrODE=[ 177.86366712525555,  220.69927064281532,  292.65434089639433, 374.64175485997526, 552.9828550057604, 954.1460988280544]
ErrODE5=[443.2542130610646, 710.0078120567616, 762.6256023415142, 1008.9793083103835, 1978.79941973206, 3161.0867515317614]
ErrODE10=[733.6149638408976, 603.1134813836258, 927.2788125769838, 1689.17342797943, 3005.3491062993644, 4088.9522569283713]
ErrODE20=[1220.2637066897344, 851.4201942939017, 1542.9691591660528, 2859.4168792642054, 3944.249245295002, 4409.388078417087]


for i=1:6
 	Tr=60;
	ts=10*(i-1)
	C=CAll[1:Tr+ts]
	Cp5=CAll[Tr+ts+1:Tr+ts+5]
	Cp10=CAll[Tr+ts+1:Tr+ts+10]
	Cp20=CAll[Tr+ts+1:Tr+ts+20]
	TrueR=TrueRAll[1:Tr+ts]
	R5=TrueRAll[Tr+ts+1:Tr+ts+5]
	R10=TrueRAll[Tr+ts+1:Tr+ts+10]
	R20=TrueRAll[Tr+ts+1:Tr+ts+20]

	tSpan=[1,length(C)]

	Order=ones(8)

	Order[1:6]=Result[1:6]
	Order[8]=Result[7]
	μp,ϕ1,ϕ2,β1,β2,δ,ψ,ω,σ,γS,γA,ηS,ηA =Result[8:20]
	S0,IA0,P0,E0=Result[21:24]

	N0=S0+E0+IA0+IS0+R0
	x0=[S0,E0,IA0,IS0,R0,P0,D0,N0]
	par2=[Λ,μ,μp,ϕ1,ϕ2,β1,β2,δ,ψ,ω,σ,γS,γA,ηS,ηA]
	_, x = FDEsolver(F, [1,length(CAll)], x0, Order, par2, h=.05, nc=4)
	PredFDE5=x[20*(Tr+ts+1):20:20*(Tr+ts+5),4:5]
	PredFDE10=x[20*(Tr+ts+1):20:20*(Tr+ts+10),4:5]
	PredFDE20=x[20*(Tr+ts+1):20:20*(Tr+ts+20),4:5]

	ErrFDE5[i]=rmsd([Cp5 R5], PredFDE5)
	ErrFDE10[i]=rmsd([Cp10 R10], PredFDE10)
	ErrFDE20[i]=rmsd([Cp20 R20], PredFDE20)

	# display(["ErrFDE5 for $i",ErrFDE5])
	# display(["ErrFDE10 for $i",ErrFDE10])
	# display(["ErrFDE20 for $i",ErrFDE20])
end

ErrFDE5=[1327.2711382256552, 2188.7617033158763, 3174.7014878616083, 5071.727702001482, 8523.184154760573, 10427.203477782]
ErrFDE10=[1613.0294416440768, 2533.7383903021146, 3584.8961816338715, 6185.110229279325, 9708.100012757981, 12040.430420880237]
ErrFDE20=[2123.8754918899267, 3104.135214804912, 5055.05040436932, 8139.496127096787, 10936.616720397804, 11105.679564997992]


using Plots

# Labels for Y-axis
y_labels = collect(60:20:160)

# Plotting
pyplot()
scatter(ErrFDE, y_labels, shape=:star,  m = (7, :white, stroke(1, :red)), label="fit FDE")
	scatter!(ErrFDE5, y_labels, shape=:circle, m = (5, :white, stroke(1, :red)), label="predict FDE5")
	scatter!(ErrFDE10, y_labels, shape=:rect, m = (5, :white, stroke(1, :red)), label="predict FDE10")
	scatter!(ErrFDE20, y_labels, shape=:diamond, m = (4, :white, stroke(1, :red)), label="predict FDE20")

	scatter!(ErrODE, y_labels, shape=:star, m = (7, :white, stroke(1, :black)), label="fit ODE")
	scatter!(ErrODE5, y_labels, shape=:circle, m = (5, :white, stroke(1, :black)), label="predict ODE5")
	scatter!(ErrODE10, y_labels, shape=:rect, m = (5, :white, stroke(1, :black)), label="predict ODE10")
	plotCV=scatter!(ErrODE20, y_labels, shape=:diamond, m = (4, :white, stroke(1, :black)), label="predict ODE20",
	 		xscale=:log, legend=:outerright, yticks=y_labels)

	xlabel!("Error Values")
	ylabel!("Training from 1 to: ")
	title!("FDE5 means preictions are checked \n for 5 further days by FDE simulation \n",  wrap=true)


savefig(plotCV,"plotCV.png")
